X.d <- runif(nCell*nB.d, -1, 1) %>% matrix(nrow=nCell)
X.p <- runif(nCell*nB.p, -1, 1) %>% matrix(nrow=nCell)
# B.d <- runif((nLC-1)*nB.d, -0.5, 0.5) %>% matrix(nrow=nB.d)
B.d <- matrix(0, nrow=nB.d, ncol=nLC-1)
B.p <- runif(nLC*nB.p, -1, 1) %>% matrix(nrow=nB.p)
nu <- GRNT[sample(1:nrow(GRNT), nCell),]
Y1 <- nu; Y2.ds <- Y1
p <- rnorm(nCell, mean(nu[,6]/(nu[,5]+nu[,6]+0.0001)), 0.05)
# GRNT, eta
for(i in 1:nCell) {
Y1[i,] <- rmvnorm(1, nu[i,], cov.grnt)
Y2.ds[i,] <- rmvnorm(1, nu[i,], cov.nlcd)
}
# combine WP + Evg
Y2.d <- cbind(Y2.ds[,1:4], Y2.ds[,5] + Y2.ds[,6])
# add bias
d <- X.d %*% B.d
Y2 <- Y2.d - d
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
d_SB1.2 <- list(N=nrow(nu), L=ncol(nu), Y1=Y.grnt, Y2=Y.nlcd, p=p)
d_SB1.2 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p)
d_SB1.4 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p)
out <- stan(file="mod_sandbox/veg_SB1_4.stan", data=d_SB1.4, thin=50)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.01)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.01) + facet_wrap(~LC)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.02) + facet_wrap(~LC)
nCell <- 200
nLC <- 6
s2.grnt <- 0.001
s2.nlcd <- s2.grnt
# cov.grnt <- cov(GRNT)
cov.grnt <- diag(s2.grnt, nLC, nLC)
cov.nlcd <- cov.grnt
nB.d <- 2
nB.p <- 2
X.d <- runif(nCell*nB.d, -1, 1) %>% matrix(nrow=nCell)
X.p <- runif(nCell*nB.p, -1, 1) %>% matrix(nrow=nCell)
# B.d <- runif((nLC-1)*nB.d, -0.5, 0.5) %>% matrix(nrow=nB.d)
B.d <- matrix(0, nrow=nB.d, ncol=nLC-1)
B.p <- runif(nLC*nB.p, -1, 1) %>% matrix(nrow=nB.p)
nu <- GRNT[sample(1:nrow(GRNT), nCell),]
Y1 <- nu; Y2.ds <- Y1
p <- rnorm(nCell, mean(nu[,6]/(nu[,5]+nu[,6]+0.0001)), 0.05)
# GRNT, eta
for(i in 1:nCell) {
Y1[i,] <- rmvnorm(1, nu[i,], cov.grnt)
Y2.ds[i,] <- rmvnorm(1, nu[i,], cov.nlcd)
}
# combine WP + Evg
Y2.d <- cbind(Y2.ds[,1:4], Y2.ds[,5] + Y2.ds[,6])
# add bias
d <- X.d %*% B.d
Y2 <- Y2.d - d
# run model
d_SB1.4 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p)
hist(p)
p <- nu[,6]/(nu[,5]+nu[,6]+0.0001)
hist(p)
nCell <- 200
nLC <- 6
s2.grnt <- 0.001
s2.nlcd <- s2.grnt
# cov.grnt <- cov(GRNT)
cov.grnt <- diag(s2.grnt, nLC, nLC)
cov.nlcd <- cov.grnt
nB.d <- 2
nB.p <- 2
X.d <- runif(nCell*nB.d, -1, 1) %>% matrix(nrow=nCell)
X.p <- runif(nCell*nB.p, -1, 1) %>% matrix(nrow=nCell)
# B.d <- runif((nLC-1)*nB.d, -0.5, 0.5) %>% matrix(nrow=nB.d)
B.d <- matrix(0, nrow=nB.d, ncol=nLC-1)
B.p <- runif(nLC*nB.p, -1, 1) %>% matrix(nrow=nB.p)
nu <- GRNT[sample(1:nrow(GRNT), nCell),]
Y1 <- nu; Y2.ds <- Y1
p <- nu[,6]/(nu[,5]+nu[,6]+0.0001)
# GRNT, eta
for(i in 1:nCell) {
Y1[i,] <- rmvnorm(1, nu[i,], cov.grnt)
Y2.ds[i,] <- rmvnorm(1, nu[i,], cov.nlcd)
}
# combine WP + Evg
Y2.d <- cbind(Y2.ds[,1:4], Y2.ds[,5] + Y2.ds[,6])
# add bias
d <- X.d %*% B.d
Y2 <- Y2.d - d
# run model
d_SB1.4 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p)
out <- stan(file="mod_sandbox/veg_SB1_4.stan", data=d_SB1.4, thin=50)
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.02) + facet_wrap(~LC)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_2_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_2_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_2_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_2_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_2_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_2_2.stan")
nCell <- 20
nLC <- 6
s2.grnt <- 0.001
s2.nlcd <- s2.grnt
cov.grnt <- cov(GRNT)
# cov.grnt <- diag(s2.grnt, nLC, nLC)
cell.samp <- sample(1:nrow(GRNT), nCell)
## generate data
nu <- GRNT[cell.samp,]
Y.grnt <- nu; Y.nlcd.dp <- nu
for(i in 1:nCell) {
Y.grnt[i,] <- rmvnorm(1, nu[i,], cov.grnt)
Y.nlcd.dp[i,] <- rmvnorm(1, nu[i,], cov.grnt)
}
plot(Y.grnt, Y.nlcd.dp); plot(nu, Y.grnt); plot(nu, Y.nlcd.dp)
d_SB1.2 <- list(N=nrow(nu), L=ncol(nu), Y1_raw=Y.grnt, Y2_raw=Y.nlcd)
d_SB1.2 <- list(N=nrow(nu), L=ncol(nu), Y1_raw=Y.grnt, Y2_raw=Y.nlcd.dp)
out <- stan(file="mod_sandbox/veg_SB1_2_2.stan", data=d_SB1.2, thin=50)
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.01) + facet_wrap(~LC, scales="free")
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.02) + facet_wrap(~LC, scales="free")
unique(gg.nu$Parameter)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_2_2.stan")
out <- stan(file="mod_sandbox/veg_SB1_2_2.stan", data=d_SB1.2, thin=50)
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.02) + facet_wrap(~LC, scales="free")
gg.nu <- ggs(out, "nu_s") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.02) + facet_wrap(~LC, scales="free")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_2_2.stan")
d_SB1.2 <- list(N=nrow(nu), L=ncol(nu), Y1=Y.grnt, Y2=Y.nlcd.dp)
out <- stan(file="mod_sandbox/veg_SB1_2.stan", data=d_SB1.2, thin=50)
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.02) + facet_wrap(~LC, scales="free")
hist(nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005))
summary(nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005))
summary(nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005) %>% logit)
summary(nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005) %>% antilogit)
summary(nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005) %>% antilogit %>% logit)
summary(nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005) %>% w_to_eta)
p <- nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005) %>% w_to_eta
hist(p)
p[p>1] <- 1; p[p<0] <- 0
p <- nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005)
p[p>1] <- 1; p[p<0] <- 0
hist(p)
nCell <- 20
nLC <- 6
s2.grnt <- 0.001
s2.nlcd <- s2.grnt
# cov.grnt <- cov(GRNT)
cov.grnt <- diag(s2.grnt, nLC, nLC)
cov.nlcd <- cov.grnt
nB.d <- 2
nB.p <- 2
X.d <- runif(nCell*nB.d, -1, 1) %>% matrix(nrow=nCell)
X.p <- runif(nCell*nB.p, -1, 1) %>% matrix(nrow=nCell)
# B.d <- runif((nLC-1)*nB.d, -0.5, 0.5) %>% matrix(nrow=nB.d)
B.d <- matrix(0, nrow=nB.d, ncol=nLC-1)
B.p <- runif(nLC*nB.p, -1, 1) %>% matrix(nrow=nB.p)
nu <- GRNT[sample(1:nrow(GRNT), nCell),]
Y1 <- nu; Y2.ds <- Y1
p <- nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005)
p[p>1] <- 1; p[p<0] <- 0
# GRNT, eta
for(i in 1:nCell) {
Y1[i,] <- rmvnorm(1, nu[i,], cov.grnt)
Y2.ds[i,] <- rmvnorm(1, nu[i,], cov.nlcd)
}
Y2.d <- cbind(Y2.ds[,1:4], Y2.ds[,5] + Y2.ds[,6])
d <- X.d %*% B.d
Y2 <- Y2.d - d
d
d_SB1.4 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p)
out <- stan(file="mod_sandbox/veg_SB1_4.stan", data=d_SB1.4, thin=50)
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.02) + facet_wrap(~LC)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_4.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
nCell <- 20
nLC <- 6
s2.grnt <- 0.001
s2.nlcd <- s2.grnt
# cov.grnt <- cov(GRNT)
cov.grnt <- diag(s2.grnt, nLC, nLC)
cov.nlcd <- cov.grnt
nB.d <- 2
nB.p <- 2
X.d <- runif(nCell*nB.d, -1, 1) %>% matrix(nrow=nCell)
X.p <- runif(nCell*nB.p, -1, 1) %>% matrix(nrow=nCell)
B.d <- runif((nLC-1)*nB.d, -0.5, 0.5) %>% matrix(nrow=nB.d)
# B.d <- matrix(0, nrow=nB.d, ncol=nLC-1)
B.p <- runif(nLC*nB.p, -1, 1) %>% matrix(nrow=nB.p)
nu <- GRNT[sample(1:nrow(GRNT), nCell),]
Y1 <- nu; Y2.ds <- Y1
p <- nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005)
p[p>1] <- 1; p[p<0] <- 0
# GRNT, eta
for(i in 1:nCell) {
Y1[i,] <- rmvnorm(1, nu[i,], cov.grnt)
Y2.ds[i,] <- rmvnorm(1, nu[i,], cov.nlcd)
}
# combine WP + Evg
Y2.d <- cbind(Y2.ds[,1:4], Y2.ds[,5] + Y2.ds[,6])
# add bias
d <- X.d %*% B.d
Y2 <- Y2.d - d
plot(Y2.d, Y2)
plot(Y2, Y2-Y2.d)
d_SB1.4 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p, d=d)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50)
d_SB1.5 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p, d=d)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50)
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.02) + facet_wrap(~LC)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50)
# visualize
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.02) + facet_wrap(~LC)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
d_SB1.5 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50)
# visualize
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.02) + facet_wrap(~LC)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.1) + facet_wrap(~LC)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.1) + facet_wrap(~LC, scales="free")
d
d_SB1.5 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50)
# visualize
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.1) + facet_wrap(~LC, scales="free")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.1) + facet_wrap(~LC)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50)
# visualize
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.1) + facet_wrap(~LC)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5_2.stan")
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50)
# visualize
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.1) + facet_wrap(~LC)
out <- stan(file="mod_sandbox/veg_SB1_5_2.stan", data=d_SB1.5, thin=50)
# visualize
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
X.d
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
B.i
B.d
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
d_SB1.5 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p, nB_d=2, X_d=X.d)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50)
X_d
X.d
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50, verbose=TRUE)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50, chains=1, verbose=TRUE)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
d_SB1.5
inits <- list(beta_d=B.d)
inits <- rep(list(beta_d=B.d), 4)
inits
str(inits)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50, init=inits)
str(inits)
inits <- rep(list(list(beta_d=B.d)), 4)
str(inits)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50, init=inits)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50, init=inits)
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.1) + facet_wrap(~LC)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50, init=0)
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.1) + facet_wrap(~LC)
nu2 <- cbind(nu[,1:4], rowSums(nu[,5:6]))
Y1.rmse <- ((nu - Y1)^2) %>% colMeans %>% sqrt
Y2.rmse <- ((nu2 - Y2)^2) %>% colMeans %>% sqrt
gg.nu %>% group_by(LC) %>% mutate(sdev=(nu.true-value)^2) %>%
summarise(mod.rmse=mean(sdev) %>% sqrt %>% round(3)) %>%
mutate(Y1.rmse=round(Y1.rmse,3),
Y2.rmse=c(round(Y2.rmse,3), NA),
diff.Y1=round(mod.rmse-Y1.rmse, 3),
propDiff.Y1=round(diff.Y1/Y1.rmse,3))
gg.Bd <- ggs(out, "beta_d")
gg.Bd$LC <- rep(1:5, each=nGG) %>% rep(nB.d)
gg.Bd$Bd.true <- rep(c(t(B.d)), each=nGG)
ggplot(gg.Bd, aes(x=Bd.true, y=value)) + geom_abline(slope=1, linetype=3) +
geom_point(alpha=0.05)
ggplot(gg.Bd, aes(x=Bd.true, y=value)) + geom_abline(slope=1, linetype=3) +
geom_point(alpha=0.1)
unique(gg.Bd$Parameter)
B.d
c(B.d)
gg.Bd$Bd.true <- B.d %>% c %>% rep(each=nGG)
ggplot(gg.Bd, aes(x=Bd.true, y=value)) + geom_abline(slope=1, linetype=3) +
geom_point(alpha=0.1)
gg.Bd <- ggs(out, "beta_d")
gg.Bd$LC <- rep(1:5, each=nGG) %>% rep(nB.d)
gg.Bd$Bd.true <- B.d %>% c %>% rep(each=nGG)
ggplot(gg.Bd, aes(x=Bd.true, y=value)) + geom_abline(slope=1, linetype=3) +
geom_point(alpha=0.1)
nCell <- 20
nLC <- 6
s2.grnt <- 0.001
s2.nlcd <- s2.grnt
# cov.grnt <- cov(GRNT)
cov.grnt <- diag(s2.grnt, nLC, nLC)
cov.nlcd <- cov.grnt
nB.d <- 2
nB.p <- 2
X.d <- runif(nCell*nB.d, -1, 1) %>% matrix(nrow=nCell)
X.p <- runif(nCell*nB.p, -1, 1) %>% matrix(nrow=nCell)
B.d <- runif((nLC-1)*nB.d, -0.5, 0.5) %>% matrix(nrow=nB.d)
# B.d <- matrix(0, nrow=nB.d, ncol=nLC-1)
B.p <- runif(nLC*nB.p, -1, 1) %>% matrix(nrow=nB.p)
nu <- GRNT[sample(1:nrow(GRNT), nCell),]
Y1 <- nu; Y2.ds <- Y1
p <- nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005)
p[p>1] <- 1; p[p<0] <- 0
# GRNT, eta
for(i in 1:nCell) {
Y1[i,] <- rmvnorm(1, nu[i,], cov.grnt)
Y2.ds[i,] <- rmvnorm(1, nu[i,], cov.nlcd)
}
# combine WP + Evg
Y2.d <- cbind(Y2.ds[,1:4], Y2.ds[,5] + Y2.ds[,6])
# add bias
d <- X.d %*% B.d
Y2 <- Y2.d - d
nCell <- 50
nLC <- 6
s2.grnt <- 0.001
s2.nlcd <- s2.grnt
# cov.grnt <- cov(GRNT)
cov.grnt <- diag(s2.grnt, nLC, nLC)
cov.nlcd <- cov.grnt
nB.d <- 2
nB.p <- 2
X.d <- runif(nCell*nB.d, -1, 1) %>% matrix(nrow=nCell)
X.p <- runif(nCell*nB.p, -1, 1) %>% matrix(nrow=nCell)
B.d <- runif((nLC-1)*nB.d, -0.5, 0.5) %>% matrix(nrow=nB.d)
# B.d <- matrix(0, nrow=nB.d, ncol=nLC-1)
B.p <- runif(nLC*nB.p, -1, 1) %>% matrix(nrow=nB.p)
nu <- GRNT[sample(1:nrow(GRNT), nCell),]
Y1 <- nu; Y2.ds <- Y1
p <- nu[,6]/(nu[,5]+nu[,6]+0.0001) + rnorm(nCell, 0, 0.005)
p[p>1] <- 1; p[p<0] <- 0
# GRNT, eta
for(i in 1:nCell) {
Y1[i,] <- rmvnorm(1, nu[i,], cov.grnt)
Y2.ds[i,] <- rmvnorm(1, nu[i,], cov.nlcd)
}
# combine WP + Evg
Y2.d <- cbind(Y2.ds[,1:4], Y2.ds[,5] + Y2.ds[,6])
# add bias
d <- X.d %*% B.d
Y2 <- Y2.d - d
d_SB1.5 <- list(N=nrow(nu), L=ncol(nu), Y1=Y1, Y2=Y2, p=p, nB_d=2, X_d=X.d)
out <- stan(file="mod_sandbox/veg_SB1_5.stan", data=d_SB1.5, thin=50, init=0)
## visualize
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.1) + facet_wrap(~LC)
rstan:::rstudio_stanc("mod_sandbox/veg_SB1_5.stan")
gg.nu <- ggs(out, "nu") %>% arrange(Parameter, Chain, Iteration)
nGG <- attr(gg.nu, "nChains")*attr(gg.nu, "nIterations")
gg.nu$nu.true <- t(nu) %>% c %>% rep(each=nGG)
gg.nu$LC <- 1:6 %>% rep(each=nGG) %>% rep(times=nCell)
ggplot(gg.nu, aes(x=nu.true, y=value)) + geom_abline(slope=1, linetype=2) +
geom_point(alpha=0.1) + facet_wrap(~LC)
gg.Bd <- ggs(out, "beta_d")
gg.Bd$LC <- rep(1:5, each=nGG) %>% rep(nB.d)
gg.Bd$Bd.true <- B.d %>% c %>% rep(each=nGG)
ggplot(gg.Bd, aes(x=Bd.true, y=value)) + geom_abline(slope=1, linetype=3) +
geom_point(alpha=0.1)
gg.Bd
ggs_density(gg.Bd) + facet_wrap(~Parameter)
gg.Bd$Bd.true <- t(B.d) %>% c %>% rep(each=nGG)
ggplot(gg.Bd, aes(x=Bd.true, y=value)) + geom_abline(slope=1, linetype=3) +
geom_point(alpha=0.1)
ggplot(gg.Bd, aes(x=Bd.true, y=value)) + geom_abline(slope=1, linetype=3) +
oeu
ggs_density(gg.Bd) + facet_wrap(~Parameter)
gg.Bd <- ggs(out, "beta_d") %>% arrange(Parameter, Chain, Iteration)
gg.Bd$LC <- rep(1:5, each=nGG) %>% rep(nB.d)
gg.Bd$Bd.true <- B.d %>% c %>% rep(each=nGG)
ggplot(gg.Bd, aes(x=Bd.true, y=value)) + geom_abline(slope=1, linetype=3) +
geom_point(alpha=0.1)
gg.Bd$Bd.true <- t(B.d) %>% c %>% rep(each=nGG)
ggplot(gg.Bd, aes(x=Bd.true, y=value)) + geom_abline(slope=1, linetype=3) +
geom_point(alpha=0.1)
nu2 <- cbind(nu[,1:4], rowSums(nu[,5:6]))
Y1.rmse <- ((nu - Y1)^2) %>% colMeans %>% sqrt
Y2.rmse <- ((nu2 - Y2)^2) %>% colMeans %>% sqrt
gg.nu %>% group_by(LC) %>% mutate(sdev=(nu.true-value)^2) %>%
summarise(mod.rmse=mean(sdev) %>% sqrt %>% round(3)) %>%
mutate(Y1.rmse=round(Y1.rmse,3),
Y2.rmse=c(round(Y2.rmse,3), NA),
diff.Y1=round(mod.rmse-Y1.rmse, 3),
propDiff.Y1=round(diff.Y1/Y1.rmse,3))
