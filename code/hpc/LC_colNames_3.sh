#!/bin/bash

# in R, determine starts as: (1:16)*90253
# and ends as (0:15)*90253+1
# This indexes the trimmed dataset which has 1,444,048 columns
# Splitting is required for processing to avoid segfaults
# The full_pieces/*.csv generated here feed into procFull.R, which summarises
# each piece across the 24 chains, saving the summaries and diagnostics.

FILES=out/full_Clim*.csv
orig_csv=($FILES)
orig_csv_full=($(basename -a $FILES))
starts=( 1 14441 28881 43321 57761 72201 86641 101081 115521 129961 144401 158841 173281 187721 202161 216601 231041 245481 259921 274361 288801 303241 317681 332121 346561 361001 375441 389881 404321 418761 433201 447641 462081 476521 490961 505401 519841 534281 548721 563161 577601 592041 606481 620921 635361 649801 664241 678681 693121 707561 722001 736441 750881 765321 779761 794201 808641 823081 837521 851961 866401 880841 895281 909721 924161 938601 953041 967481 981921 996361 1010801 1025241 1039681 1054121 1068561 1083001 1097441 1111881 1126321 1140761 1155201 1169641 1184081 1198521 1212961 1227401 1241841 1256281 1270721 1285161 1299601 1314041 1328481 1342921 1357361 1371801 1386241 1400681 1415121 1429561 )
ends=( 14440 28880 43320 57760 72200 86640 101080 115520 129960 144400 158840 173280 187720 202160 216600 231040 245480 259920 274360 288800 303240 317680 332120 346560 361000 375440 389880 404320 418760 433200 447640 462080 476520 490960 505400 519840 534280 548720 563160 577600 592040 606480 620920 635360 649800 664240 678680 693120 707560 722000 736440 750880 765320 779760 794200 808640 823080 837520 851960 866400 880840 895280 909720 924160 938600 953040 967480 981920 996360 1010800 1025240 1039680 1054120 1068560 1083000 1097440 1111880 1126320 1140760 1155200 1169640 1184080 1198520 1212960 1227400 1241840 1256280 1270720 1285160 1299600 1314040 1328480 1342920 1357360 1371800 1386240 1400680 1415120 1429560 1444048 )

for f in {0..23}
do
	f_nm="${orig_csv_full[$f]}"
	base_nm="${f_nm%.csv}"
	# cut out/full*.csv to include only columns identified in LC_colNames_2.R
	sed '/^#/ d' out/$f_nm | cut -d "," -f1-67,969123-969139,1938195-3382142,3616368-3616383 > full_cut/$f_nm
	# slice this reduced output into pieces for processing with procFull.R
	for i in {0..99}
	do
	  pt_nm=$base_nm
	  pt_nm+="_"
	  pt_nm+=$i
	  pt_nm+=".csv"
	  rng=${starts[$i]}-${ends[$i]}
	  cut -d "," -f$rng full_cut/$f_nm > full_pieces/$pt_nm
	done
done